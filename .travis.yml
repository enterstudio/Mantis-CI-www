branches:
  only:
    - master
before_install:
  # Unpack ssh key for git
  - echo -n $id_rsa_{00..30} >> ~/.ssh/id_rsa_base64
  - base64 --decode --ignore-garbage ~/.ssh/id_rsa_base64 > ~/.ssh/id_rsa
  - chmod 600 ~/.ssh/id_rsa
  # Disable SSH server fingerprint verification
  - echo -e "Host github.com\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
  # Clone afresh and checkout a new branch to run the deploy from
  - git config --global user.email "imbleedingme@googlemail.com"
  - git config --global user.name "Floyd Pink"
  - git clone $REPO.git Travis-CI-www
  - cd Travis-CI-www
  - git checkout -b deploy-web
  - sudo apt-get install nodejs npm
  - npm install -g grunt-cli
  - npm install
script:
  # run the grunt task to build the app for web
  - grunt web
after_success:
  # read the git-describe version from the file generated by grunt build
  - VERSIONSTRING=`head -1 git-describe`
  # remove all the unnecessary files
  - rm -rf node_modules
  - git rm -rf --quiet package.json README.md Gruntfile.js localServer.js js/app/ js/lib/ css/jquery.mobile-1.3.0.css css/style.css
  # commit
  - git commit -a -m "Committed $VERSIONSTRING from CI (build number - $((TRAVIS_JOB_ID - 1))) [ci skip]"
  # push to gh-pages
  - git push origin deploy-web:gh-pages --force
env:
  global:
    # Repo read-write address
    - REPO="git@github.com:floydpink/Travis-CI-www"
    # SSH key. Encoded. See https://gist.github.com/4631240
    - secure: "UZ3jq2DxZUuE49MMKL3H3iOyNPLlyvgEf1v65V3dm4vxqoq+NBqgwH9CppCwtpTQK5NZ34lEPR+wpabqY6gpJko7gltD+SCDrop4hUL9EM7czX2C6+YsbYw+v7faYDu7ziO19Ii1fLEeWD3JnthA8pGf39tYPx6Tht3uiDB8Mv0="
    - secure: "ZWlHFMmPFlnL5kSVVWZn8x3oOssQPqUDIEq4lGdVHmCakYATsUgWHZ7e+dBTfonl+AfHR2djLWTjCu+XAcffl4PUGeT3Xa3eVtasmY4/Hv4FmR0nHkbZ1rAaixHvcQsBoDA6f2SDxCsldNlqYtz8VejOXKMMLE9qb0t8uxOvbyw="
    - secure: "cM2gYDDue7eJWH8ZT+woZmzhkxp6N6wsWA+8IkeL0V7gDLAUkn4tzBkNufGE9N6AH3wAbT37GUslg8PQeNTaIf7KNl/PoRhZ+kujqqkmqlS+O3qwFHmvMds6cA0WOl6Y6thkRm0vv/JL5gQntucfcdCa5vkjGsoJB7Uam8DGjBg="
    - secure: "ALnhuB9Hhh1J01EgvjEwOa22M+ykAXt7lpRbjqvmjsRoEOvznU0byq7NBQe/XXmZfQrrN5Rp94Qj18fs5yOe6FaQ4ZswAU6PhcAaHEfOGqFPMpyz9wgcJq26BKt19JzQ3dfwbAFPMbfOlcR9Ctzg47JKlH4jBdAzQ/Eiq8OwCQM="
    - secure: "Sb+DuteUCxj1bOSCm5ZiH3NZZzMPTTkpvfu1eHVvx50IE1Mu3bXWtRUmnEyZ92+jAN9cFk7Y0IGS+DkEbYFUWk9SbGlDRQ6eNnJk1sH6wyrlq+34cbWu9iN1zz49V0r8c0Q4mMampmDfhPaCEe6KrjFD6HOHZg5aFnGeXOY+EDc="
    - secure: "UBZOFmBCUNfW6dHTAy+3CD0KsVS3kUqPKl+SLDMjxPoA2Kpj029U9WuS0IG8jZGlKLftaKM4oJQBy/7ycAUha/wIeTxWp9ePBJPvFEMi/pppsFkkww9Es6YbOg6YPoGRfVGGQWgRfstE9NBQebVITtSOYciHk39q9pspFGzarFs="
    - secure: "WC2PnzlBu1rso4fvXZtgHyzinx5Nf3TxkXq5g1NpzqmQWsGLLqxFoi0Xb9R1ZSRGw3rMT7jTNLAHgtJCSOHxG9oKVkXc9q/ikNvCqeQx/Q0K3uHL8MJOrKI3QnZkgnst/KE5z13G8ax0pPgvB1sDRXPii/mW0Q94v0a9OXsTkls="
    - secure: "FOVvh1RH08U/NnC6lJK8JJbRFMa2ikQATyPlR+JlYAB56SbcGTf9AD0i6X3bhDB1LspwoMeVmGP92mDehKwlkB91tnYQb6SWyLNk7jqne9uIh/aFDxrv2KZu0cmJd+iXZCuY+1TDdbPgsw98fM/azjQM15ccnYGiFPF66X+Ez0c="
    - secure: "UukDQ060BzcafjCkXqFiGsG/Q+avdDH4c9Xn1g+xiwxJtEvjNbceCyb9F7h4rIIZbZ4Qo9TW+upvmyBV+zIf482+FESoMxrkMBfVap/58kY6Xd1PKGcFtCXz+pt+i0wJFoXuDCFD/KMQM1yXCqsgPJkK+Z43B0KI/3kMQjJISnA="
    - secure: "Zo1UVtApq/Wyng8aG+eNDhNI85nV2JlkeAFcVVK5cxAz2COBGll11GK2QtF9TZorF5WFfPBx6F3qIUX1K5zSvgy7C1HgteNIDvR0ZdXD/EjVSuKOhDz0kJWddCiHbjdVVILXhSTh9cF9ezqOEv3MhCN7pJkgDY/pBMtnyboyN6Y="
    - secure: "T+lLVDu7saW6SpQHoc/wphfrDm+OsBUjXdN7nTivz+hFWeHiVjqgnd5tg8Mv/2gdyfRqIy4Py2xXZIQ/3Jk4dssxxbgkFscMw1rAZKCLkD3X8sOPrimEOwA5mUfe56Shc0pMaOYtkIjST8DeqfrYAovp4x+PSbXwsaaGtePcYp8="
    - secure: "OPr4lZTP+4X9X6J3Yz2v59s2Hf2rcbJJgz+zisPydJw8v7VI33gL2Q7iQGQ6scWx+Un2eDkIiQ2Wv036ZrWyyZ8Cvhq77uV5HKwDbQK0TO5nIV9N3D/ry7xZWJxMbcOsb6bUSiPD/9OeiWEQbh3O5tdxiGaeWwfUNIuRVL5OgWk="
    - secure: "fJOIcfypkjrpodQCVBh7sVbSfUVKDMnGHlsEIbHQilDtbPZPrATk19mPWwvFxQDuXa9uz+OkA+/up3/W7k+3i1DvAkHXLGV1EzHiUOfXGr+LhVWw7a7FHYyNvhX4C6klxlejfJteYxxwvRISChzp43g6s34P1UUkZ/ekKb4sOl4="
    - secure: "gxbhy+RdGQw8/fS0Ij16URQe041Jo+5NV+PAO8l35uKgO26mnkInN+AWlSpnllAEnTLjBTrtGHnY/nBN+fSYADEGY7/FSQ5zkWAtKuGNCWcdMzHp3Lh3btam/HR0zmgfQWYd2j5LSi1Onq6tok3zFGXsyP+EGXDjDA5iLMMYpQo="
    - secure: "K+8FOuwjYRiC1JOewr3UySofJ11Fgka8eCulXvrB0xU8vdV9S+Nn6P1/0FsquMYGolUCoGiMHpdhbXZBbz6CoE7KJEvQgOi7qX570wKR06cVNdPPPYCfxXr2SnpMvCwg5fMTcL1mtXTnK3Fh3rB5be5E8ORx+Ez0KnGmYuFlrwE="
    - secure: "XBuDumreoAYrPwY07PRx4+2KdWu9iUmHh1+U2YDUoBMuHlkI6l1Iwuw1pwc4nGsDRidMnKiBkiU7cgVvvURe543WSI6u3aIpRemjrd0+lIQFiQRgqBDFIy1YZOJTU+/7t+DDq3fWo3w/jhIDsPZtZnRfKMh5DzGFzsBAXLLIs2Y="
    - secure: "SlMXQerlfVEjcB+Llq5tCwW7a73NDSlO3Sk/woY2HB+HVrk7PGBZ4W69lABIubYbOPpoFabd317clfk7aq+FOwpdksXo6uWZ+rX6nhzBigJjAfKPMLy6Lxx4OGdTKcZVI/MKyXlsLnYo3Nv2vq8Fef+8pgllwPh7e5Z5EhU1QrY="
    - secure: "Dpakt9gpSSoEzft6E1Z5ylNlc9pvkTKwhYyioC87ZlFuFc/22XRXdA1derZc5S88rRfFapDjhRVTxEbcbnvunmyKnZCrnswJyf7e8Nc2FtEiFwm1niiB5/usmqlzatsHtytSZ3TiUzYTo6vHC1DX4XxJ1j/qncXbWYpt8MBdQSo="
    - secure: "T0DMEKdRjr4vFcEiz/d8p/UT12pqk6Lp1Ha8ds0nsY8h5WHloko+Hh43kGgefXouROh0aeUKlkoi6CD0dg/2bBtOUS4geOT/uxAdaZf+pgljso4VmZZoVHKGC+soPD3U70Dvx/9DYmYe18HSVhCfFE2lDj8wDqN4cO4CWOMbXTk="
    - secure: "b/HG7ZcE99hHZ9PFjhZevKaobAc9FEmIAPI+BC41KQykBjL548qNUs98YMypIJ1Ba8AGlxaNLBeWu4GAL6OQSxAKqPSOeO0YzrVTQrbtwTjRCTh78PGi3t37+EEkkVmWXamZ6Jpl3a6v9lFa4XJU1LsaWb21bfXvapqIg5AzIA8="
    - secure: "ZioQC72RB+3hUZ+XpewSF/7JvnCxcVF8gScMGSWwW9UyVUwQZhlBY4l7hSLlFrrJX6uv/boQTFK5bMfkQM5NVcjU6rpB8yY/xA1ID2jHfOvefr9mjoXCzZrXCYRXf9wSSWo/qtoMq11oh6CnlHDqyfScxMPdTJ05TPqxwD5Za/4="
    - secure: "b2lcp1SSkfVPrIus/mi8VLGjC39ARgTBUbcadw2Woc7mbu131LvOE0L9ZY0qGh5gxNCKI+Q/w/nOB5D4KTnfsa6OrmP6O2AUvzCCTBl/sZMI5fM1AibEqJexaNz/tf75szcC1zHNdqMMglGNhoBdPKjF+mWSI8fjimEmey8C+CU="
    - secure: "XpHAZ+ImReh4DyndwOe7LOZfajuTsKdr0EqbJddmNLIAwTWtvrN3XQU2/Xfg3cT503vOJULWpdImz3PG5uUp77WgWjQQm0TUewcSPO1iXKzuFlDr1DkzRGSDgRXf1egdG9//Nmvib3G1x5gTLoc8qSzHfsBvqIUQ+8UwEeEHGJk="